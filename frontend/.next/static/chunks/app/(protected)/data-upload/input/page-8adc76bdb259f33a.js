(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[585],{518:function(e,t,s){Promise.resolve().then(s.bind(s,1592))},7171:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(2289).Z)("brain",[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]])},9518:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});let l=(0,s(2289).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},1592:function(e,t,s){"use strict";s.r(t);var l=s(3107),a=s(8396),r=s(6201),i=s(7973),c=s(8641),n=s(5473),d=s(8477),o=s(7171),x=s(2861),h=s(4867),m=s(9339),u=s(9518),g=s(9737),p=s(2692),f=s(5058);t.default=()=>{let[e,t]=(0,a.useState)(null),[b,j]=(0,a.useState)(null),[w,N]=(0,a.useState)(!1),[v,y]=(0,a.useState)(null),[k,_]=(0,a.useState)(!1),[A,C]=(0,a.useState)([]),[D,I]=(0,a.useState)(null),[S,E]=(0,a.useState)(null),[Z,z]=(0,a.useState)({}),M=(0,a.useRef)(null),O=async()=>{if(!e){I("업로드할 파일을 선택해주세요.");return}N(!0),I(null);try{let t=await Promise.all([s.e(531),s.e(381)]).then(s.bind(s,1999)),l=await e.arrayBuffer(),a=t.read(l,{type:"array"}),r=a.Sheets[a.SheetNames[0]],i=t.utils.decode_range(r["!ref"]||"A1"),c=[];for(let e=i.s.c;e<=i.e.c;e++){let s=r[t.utils.encode_cell({r:0,c:e})];s&&s.v&&c.push(s.v.toString().trim())}if(!L(c)){N(!1);return}let n=t.utils.sheet_to_json(r,{header:c,range:1,defval:""}).map(e=>({...e,AI추천답변:""})),d=n.map((e,t)=>({id:"input-".concat(t),originalData:e,modifiedData:{...e},isEditing:!1})),o={filename:e.name,fileSize:(e.size/1024/1024).toFixed(2),data:n,columns:[...c,"AI추천답변"]};j(o),C(d),I(null),await T(o)}catch(e){console.error("파일 업로드 오류:",e),I("파일 업로드 중 오류가 발생했습니다.")}finally{N(!1)}},L=e=>{let t=["로트번호","생산품명","생산수량","투입일","종료일","공정","투입물명","수량","단위"];if(!t.every(t=>e.some(e=>t.trim().toLowerCase().replace(" ","").replace("_","")===e.trim().toLowerCase().replace(" ","").replace("_","")))){let s=t.filter(t=>!e.some(e=>t.trim().toLowerCase().replace(" ","").replace("_","")===e.trim().toLowerCase().replace(" ","").replace("_","")));return I("템플릿을 확인해 주세요. 누락된 컬럼: ".concat(s.join(", "))),!1}return!0},T=async e=>{if(!e||!e.data||0===e.data.length){console.log("AI 처리할 데이터가 없습니다.");return}_(!0),I(null);try{var t;let s="http://localhost:8080";console.log("=== AI 처리 시작 ==="),console.log("게이트웨이 URL:",s),console.log("전송할 데이터:",e);let l=await fetch("".concat(s,"/ai-process-stream"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:e.filename,data:e.data,columns:e.columns})});if(!l.ok)throw Error("AI 처리 요청 실패: ".concat(l.status));console.log("AI 처리 응답 수신, 스트리밍 시작...");let a=null===(t=l.body)||void 0===t?void 0:t.getReader();if(!a)throw Error("스트리밍 응답을 읽을 수 없습니다.");let r=[],i=[];for(;;){let{done:t,value:s}=await a.read();if(t){console.log("스트리밍 완료");break}for(let t of new TextDecoder().decode(s).split("\n"))if(t.startsWith("data: "))try{let s=JSON.parse(t.slice(6));if(console.log("스트리밍 데이터 수신:",s),"completed"===s.status){r=s.data||[],i=s.columns||[],console.log("AI 처리 완료:",{totalRows:s.total_rows,processedRows:s.processed_rows,data:r,columns:i}),y({status:"completed",message:"AI 처리가 완료되었습니다.",filename:e.filename,total_rows:s.total_rows||0,processed_rows:s.processed_rows||0,data:r,columns:i});let t=r.map((e,t)=>({id:"input-".concat(t),originalData:e,modifiedData:{...e},isEditing:!1}));C(t),I(null)}else"processing"===s.status&&console.log("AI 처리 진행 중:",s.message)}catch(e){console.error("JSON 파싱 오류:",e)}}}catch(e){console.error("AI 처리 오류:",e),I("AI 처리 중 오류가 발생했습니다: ".concat(e))}finally{_(!1)}},R=(e,t,s)=>{C(l=>l.map(l=>l.id===e?{...l,modifiedData:{...l.modifiedData,[t]:s}}:l))},$=e=>{C(t=>t.map(t=>t.id===e?{...t,isEditing:!t.isEditing}:t))},J=async e=>{let t=A.find(t=>t.id===e);if(!t)return;let s=Z[e]||"";if(!s.trim()){I("수정 사유를 입력해주세요.");return}try{let l={공정:t.modifiedData["공정"]||"",투입물명:t.modifiedData["투입물명"]||"",수정된결과:t.modifiedData["AI추천답변"]||"",사유:s,생산품명:t.modifiedData["생산품명"]||""},a=await fetch("".concat("http://localhost:8080","/save-feedback"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!a.ok)throw Error("피드백 저장 실패: ".concat(a.status));C(t=>t.map(t=>t.id===e?{...t,isEditing:!1,originalData:{...t.modifiedData}}:t)),z(t=>{let s={...t};return delete s[e],s}),I(null),console.log("피드백 저장 성공:",l)}catch(e){console.error("피드백 저장 오류:",e),I("피드백 저장 중 오류가 발생했습니다: ".concat(e))}},P=(e,t)=>{if(t.length>20)return console.log("글자 수 초과: ".concat(e," - ").concat(t.length,"글자")),!1;switch(e){case"로트번호":case"생산수량":case"수량":let s=/^\d*$/.test(t);return s||console.log("숫자만 입력 가능: ".concat(e," - ").concat(t)),s;case"투입일":case"종료일":let l=/^\d{4}-\d{2}-\d{2}$/.test(t)||""===t;return l||console.log("날짜 형식 오류: ".concat(e," - ").concat(t)),l;case"생산품명":case"공정":case"투입물명":case"단위":let a=/^[가-힣a-zA-Z0-9\s\-_()]*$/.test(t);return a||console.log("텍스트 입력 오류: ".concat(e," - ").concat(t)),a;default:return!0}},q=(e,t)=>{let s=e.modifiedData[t]||"",a=!e.originalData||0===Object.keys(e.originalData).length,r=a&&["로트번호","생산품명","생산수량","투입일","종료일","공정","투입물명","수량","단위"].includes(t);s&&s.toString().trim();let i=()=>{let t="w-full px-2 py-1 border rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500";return a?t+=" border-green-300 bg-green-50":e.isEditing?t+=" border-blue-300 bg-blue-50":t+=" border-gray-300 bg-white",t};switch(t){case"로트번호":case"생산수량":case"수량":return(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("input",{type:"text",value:s,maxLength:20,onChange:s=>{let l=s.target.value;P(t,l),R(e.id,t,l)},placeholder:r?"숫자만 입력 *":"숫자만 입력",className:i()}),r&&(0,l.jsx)("span",{className:"absolute -top-2 -right-2 text-red-500 text-xs",children:"*"})]});case"투입일":case"종료일":return(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("input",{type:"date",value:s,onChange:s=>R(e.id,t,s.target.value),className:i()}),r&&(0,l.jsx)("span",{className:"absolute -top-2 -right-2 text-red-500 text-xs",children:"*"})]});case"생산품명":case"공정":case"투입물명":case"단위":return(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("input",{type:"text",value:s,maxLength:20,onChange:s=>{let l=s.target.value;P(t,l),R(e.id,t,l)},placeholder:r?"한글/영문/숫자 입력 *":"한글/영문/숫자 입력",className:i()}),r&&(0,l.jsx)("span",{className:"absolute -top-2 -right-2 text-red-500 text-xs",children:"*"})]});case"AI추천답변":return(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("input",{type:"text",value:s,maxLength:20,onChange:s=>R(e.id,t,s.target.value),placeholder:a?"AI 추천 답변을 입력하세요":"AI 추천 답변을 수정하거나 입력하세요",className:"w-full px-2 py-1 border rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat(a?"border-green-300 bg-green-50":"border-blue-300 bg-blue-50")}),(0,l.jsx)("span",{className:"absolute -top-2 -right-2 text-xs ".concat(a?"text-green-500":"text-blue-500"),children:"✏️"})]});default:return(0,l.jsx)("span",{children:s||"-"})}};return(0,l.jsx)(r.Z,{children:(0,l.jsxs)("div",{className:"w-full h-full p-4 lg:p-6 xl:p-8 space-y-4 lg:space-y-6 xl:space-y-8",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,l.jsx)(f.default,{href:"/data-upload",children:(0,l.jsxs)(p.zx,{variant:"outline",className:"border-white/20 text-white/80 hover:bg-white/10",children:[(0,l.jsx)(i.Z,{className:"w-4 h-4 mr-2"}),"뒤로가기"]})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"stitch-h1 text-xl lg:text-2xl xl:text-3xl font-bold",children:"실적정보(투입물)"}),(0,l.jsx)("p",{className:"stitch-caption text-white/60 text-xs lg:text-sm",children:"생산 과정에서 투입되는 원재료, 부재료 등의 데이터를 업로드하고 AI로 표준화합니다."})]})]}),(0,l.jsxs)("div",{className:"flex-1 min-h-0 space-y-6",children:[(0,l.jsxs)("div",{className:"stitch-card p-6",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,l.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,l.jsx)(c.Z,{className:"w-5 h-5 text-blue-600"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-white",children:"템플릿 다운로드"}),(0,l.jsx)("p",{className:"text-sm text-white/60",children:"표준 형식의 템플릿을 다운로드하여 데이터 입력에 활용하세요"})]})]}),(0,l.jsxs)(p.zx,{onClick:()=>{let e=document.createElement("a");e.href="/templates/실적_데이터_인풋.xlsx",e.download="실적_데이터_인풋.xlsx",document.body.appendChild(e),e.click(),document.body.removeChild(e)},className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors",children:[(0,l.jsx)(c.Z,{className:"w-4 h-4 mr-2"}),"템플릿 다운로드"]})]}),(0,l.jsxs)("div",{className:"stitch-card p-6",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,l.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:(0,l.jsx)(n.Z,{className:"w-5 h-5 text-green-600"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Excel 업로드"}),(0,l.jsx)("p",{className:"text-sm text-white/60",children:"템플릿 형식에 맞는 Excel 파일을 업로드하면 AI가 자동으로 투입물명을 표준화합니다"})]})]}),(0,l.jsxs)("div",{className:"border-2 border-dashed rounded-xl p-12 text-center transition-all duration-200 ".concat(e?"border-green-400 bg-green-50":"border-white/20 hover:border-primary hover:bg-white/5"),onDrop:e=>{e.preventDefault();let s=e.dataTransfer.files;if(s.length>0){let e=s[0];e.name.match(/\.(xlsx|xls)$/)?(t(e),I(null)):I("엑셀 파일만 업로드 가능합니다 (.xlsx, .xls)")}},onDragOver:e=>{e.preventDefault()},children:[(0,l.jsx)("input",{ref:M,type:"file",accept:".xlsx,.xls",onChange:e=>{var s;let l=null===(s=e.target.files)||void 0===s?void 0:s[0];if(l){if(!l.name.match(/\.(xlsx|xls)$/)){I("엑셀 파일만 업로드 가능합니다 (.xlsx, .xls)"),t(null);return}t(l),I(null),j(null),C([]),y(null)}},className:"hidden"}),e?(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{className:"w-16 h-16 mx-auto bg-green-100 rounded-full flex items-center justify-center",children:(0,l.jsx)(d.Z,{className:"w-8 h-8 text-green-600"})}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("p",{className:"text-lg font-medium text-white mb-2",children:["선택된 파일: ",e.name]}),(0,l.jsxs)("p",{className:"text-sm text-white/60 mb-4",children:["파일 크기: ",(e.size/1024/1024).toFixed(2)," MB"]}),(0,l.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,l.jsx)(p.zx,{onClick:O,disabled:w,className:"bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition-colors disabled:opacity-50",children:w?"업로드 중...":"업로드 시작"}),(0,l.jsx)(p.zx,{onClick:()=>{t(null),j(null),C([]),y(null)},className:"bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors",children:"파일 변경"})]})]})]}):(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("div",{className:"w-16 h-16 mx-auto bg-white/10 rounded-full flex items-center justify-center",children:(0,l.jsx)(n.Z,{className:"w-8 h-8 text-white/60"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-lg font-medium text-white mb-2",children:"파일을 드래그하여 업로드하거나 클릭하여 선택하세요"}),(0,l.jsx)("p",{className:"text-sm text-white/60 mb-4",children:"지원 형식: .xlsx, .xls"}),(0,l.jsx)(p.zx,{onClick:()=>{var e;return null===(e=M.current)||void 0===e?void 0:e.click()},className:"bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-lg transition-colors",children:"파일 선택"})]})]})]})]}),k&&(0,l.jsx)("div",{className:"stitch-card p-6",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,l.jsx)(o.Z,{className:"w-5 h-5 text-blue-600"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-white",children:"AI 처리 중..."}),(0,l.jsx)("p",{className:"text-sm text-white/60",children:"데이터를 분석하고 표준화하는 중입니다. 잠시만 기다려주세요."})]})]})}),b&&A.length>0&&(0,l.jsxs)("div",{className:"stitch-card p-6",children:[(0,l.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-white",children:"데이터 미리보기"}),(0,l.jsxs)("p",{className:"text-sm text-white/60",children:["파일: ",b.filename," | 크기: ",b.fileSize," MB | 행 수: ",b.data.length]})]})}),(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full border-collapse border border-white/20",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"bg-white/10",children:[b.columns.map(e=>(0,l.jsx)("th",{className:"border border-white/20 px-3 py-2 text-left text-sm font-medium text-white",children:e},e)),(0,l.jsx)("th",{className:"border border-white/20 px-3 py-2 text-left text-sm font-medium text-white",children:"작업"})]})}),(0,l.jsx)("tbody",{children:A.map(e=>(0,l.jsxs)("tr",{className:"border-b border-white/10 hover:bg-white/5",children:[b.columns.map(t=>(0,l.jsx)("td",{className:"border border-white/20 px-3 py-2 text-sm text-white",children:e.isEditing?q(e,t):(0,l.jsx)("span",{children:e.modifiedData[t]||"-"})},t)),(0,l.jsx)("td",{className:"border border-white/20 px-3 py-2 text-sm",children:e.isEditing?(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsxs)(p.zx,{onClick:()=>J(e.id),className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs",children:[(0,l.jsx)(x.Z,{className:"w-3 h-3 mr-1"}),"저장"]}),(0,l.jsxs)(p.zx,{onClick:()=>$(e.id),className:"bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-xs",children:[(0,l.jsx)(h.Z,{className:"w-3 h-3 mr-1"}),"취소"]})]}):(0,l.jsxs)(p.zx,{onClick:()=>$(e.id),className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs",children:[(0,l.jsx)(m.Z,{className:"w-3 h-3 mr-1"}),"편집"]})})]},e.id))})]})}),A.some(e=>e.isEditing)&&(0,l.jsxs)("div",{className:"mt-4 p-4 bg-white/5 rounded-lg",children:[(0,l.jsx)("h4",{className:"text-sm font-medium text-white mb-2",children:"수정 사유 입력"}),(0,l.jsx)("div",{className:"flex gap-4",children:A.filter(e=>e.isEditing).map(e=>(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("label",{className:"block text-xs text-white/60 mb-1",children:["행 ",e.id," 수정 사유"]}),(0,l.jsx)(p.II,{type:"text",value:Z[e.id]||"",onChange:t=>z(s=>({...s,[e.id]:t.target.value})),placeholder:"수정 사유를 입력하세요",className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary"})]},e.id))})]})]}),v&&(0,l.jsx)("div",{className:"stitch-card p-6",children:(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,l.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:(0,l.jsx)(u.Z,{className:"w-5 h-5 text-green-600"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-white",children:"AI 처리 완료"}),(0,l.jsxs)("p",{className:"text-sm text-white/60",children:["총 ",v.total_rows,"행 중 ",v.processed_rows,"행이 처리되었습니다."]})]})]})}),D&&(0,l.jsx)("div",{className:"stitch-card p-6 bg-red-500/10 border border-red-500/20",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:(0,l.jsx)(g.Z,{className:"w-5 h-5 text-red-600"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-red-400",children:"오류 발생"}),(0,l.jsx)("p",{className:"text-sm text-red-300",children:D})]})]})})]})]})})}}},function(e){e.O(0,[341,757,567,201,817,327,309,691,744],function(){return e(e.s=518)}),_N_E=e.O()}]);