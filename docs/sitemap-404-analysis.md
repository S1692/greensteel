# GET /api/sitemap 404 ë¬¸ì œ ë¶„ì„ ë° í•´ê²° ë¦¬í¬íŠ¸

## ğŸ“‹ ë¬¸ì œ ìš”ì•½

**ë¬¸ì œ**: ëª¨ë‹¬ì„ í†µí•œ DB ë°ì´í„° ê²€ìƒ‰ ê¸°ëŠ¥ì—ì„œ GET /api/sitemap 404 ì—ëŸ¬ ë°œìƒ

**ì˜í–¥**: êµ­ê°€ ê²€ìƒ‰ ëª¨ë‹¬ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ì§€ ì•ŠìŒ

**ë°œìƒ ê²½ë¡œ**: í”„ë¡ íŠ¸ì—”ë“œ(Next.js) â†’ ê²Œì´íŠ¸ì›¨ì´(FastAPI) â†’ auth_service(FastAPI, Railway)

## ğŸ” ì›ì¸ ë¶„ì„

### 1. ë¼ìš°í„° ë¯¸ë“±ë¡ (ì£¼ìš” ì›ì¸)
- **ë¬¸ì œ**: `auth_service`ì— `/api/sitemap` ì—”ë“œí¬ì¸íŠ¸ê°€ ì •ì˜ë˜ì–´ ìˆì§€ ì•ŠìŒ
- **ì¦ê±°**: 
  - `service/auth_service/app/router/` ë””ë ‰í† ë¦¬ì— sitemap ê´€ë ¨ ë¼ìš°í„° íŒŒì¼ ì—†ìŒ
  - `main.py`ì—ì„œ sitemap ë¼ìš°í„° ë“±ë¡ ëˆ„ë½
  - í”„ë¡ íŠ¸ì—”ë“œì—ì„œ `/api/sitemap` í˜¸ì¶œ ì‹œ 404 ì‘ë‹µ

### 2. ê²Œì´íŠ¸ì›¨ì´ ë§¤í•‘ ì„¤ì •
- **í˜„ì¬ ì„¤ì •**: `/api/*` â†’ `auth_service`ë¡œ ë¼ìš°íŒ…
- **ë¬¸ì œ**: ë§¤í•‘ì€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì–´ ìˆì§€ë§Œ, íƒ€ê²Ÿ ì„œë¹„ìŠ¤ì— í•´ë‹¹ ì—”ë“œí¬ì¸íŠ¸ê°€ ì—†ìŒ

### 3. í”„ë¡ íŠ¸ì—”ë“œ API í˜¸ì¶œ
- **í˜„ì¬ êµ¬í˜„**: `/api/v1/countries/search` ì‚¬ìš©
- **ë¬¸ì œ**: í•´ë‹¹ ì—”ë“œí¬ì¸íŠ¸ê°€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ì ‘ê·¼ ë¶ˆê°€

## ğŸ› ï¸ í•´ê²° ë°©ì•ˆ

### 1. sitemap ë¼ìš°í„° ìƒì„±
```python
# service/auth_service/app/router/sitemap.py
router = APIRouter(prefix="/api", tags=["sitemap"])

@router.get("/sitemap", response_model=SitemapResponse)
async def get_sitemap(
    q: Optional[str] = Query(None, description="ê²€ìƒ‰ì–´ (korean_name ê¸°ì¤€)"),
    page: int = Query(1, ge=1, description="í˜ì´ì§€ ë²ˆí˜¸"),
    limit: int = Query(10, ge=1, le=100, description="í˜ì´ì§€ë‹¹ í•­ëª© ìˆ˜"),
    db: Session = Depends(get_db)
):
    # korean_name ê¸°ì¤€ ê²€ìƒ‰ êµ¬í˜„
```

### 2. ì‘ë‹µ ìŠ¤í‚¤ë§ˆ ì •ì˜
```python
# service/auth_service/app/domain/schemas/sitemap.py
class SitemapItem(BaseModel):
    id: str
    title: str  # korean_name ê°’
    url: str
    updated_at: Optional[datetime] = None

class SitemapResponse(BaseModel):
    items: List[SitemapItem]
    total: int
    page: int
    limit: int
```

### 3. ë¼ìš°í„° ë“±ë¡
```python
# service/auth_service/main.py
from app.router import auth_router, stream_router, sitemap_router

app.include_router(sitemap_router, tags=["sitemap"])
```

### 4. í”„ë¡ íŠ¸ì—”ë“œ API í˜¸ì¶œ ìˆ˜ì •
```typescript
// frontend/src/components/CountrySearchModal.tsx
const response = await fetch(
  `/api/sitemap?q=${encodeURIComponent(query)}&page=1&limit=20`
);
```

## ğŸ”§ êµ¬í˜„ëœ ë³€ê²½ì‚¬í•­

### ë°±ì—”ë“œ (auth_service)
1. âœ… `sitemap.py` ë¼ìš°í„° ìƒì„±
2. âœ… `sitemap.py` ìŠ¤í‚¤ë§ˆ ìƒì„±  
3. âœ… `main.py`ì— ë¼ìš°í„° ë“±ë¡
4. âœ… ë¼ìš°íŠ¸ í…Œì´ë¸” ë¡œê¹… ì¶”ê°€

### í”„ë¡ íŠ¸ì—”ë“œ
1. âœ… `CountrySearchModal.tsx`ì—ì„œ `/api/sitemap` API í˜¸ì¶œë¡œ ë³€ê²½
2. âœ… sitemap ì‘ë‹µ í˜•ì‹ì— ë§ê²Œ ë°ì´í„° ë³€í™˜ ë¡œì§ ì¶”ê°€
3. âœ… í™˜ê²½ë³€ìˆ˜ ì„¤ëª… ì—…ë°ì´íŠ¸

### ê²Œì´íŠ¸ì›¨ì´
1. âœ… ìƒì„¸í•œ ìš”ì²­/ì‘ë‹µ ë¡œê¹… ê°•í™”
2. âœ… ë””ë²„ê¹…ì„ ìœ„í•œ í—¤ë” ë° ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ë¡œê¹… ì¶”ê°€

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 1. ê¸°ë³¸ ë™ì‘ í…ŒìŠ¤íŠ¸
- [ ] GET /api/sitemap (no query) â†’ 200 + ë¹ˆ ë°°ì—´
- [ ] GET /api/sitemap?q=í•œêµ­ â†’ 200 + korean_name ê¸°ì¤€ ê²€ìƒ‰ ê²°ê³¼
- [ ] GET /api/sitemap?q=í•œêµ­&page=1&limit=5 â†’ 200 + í˜ì´ì§• ê²°ê³¼

### 2. ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
- [ ] ì˜ëª»ëœ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° â†’ 422 Validation Error
- [ ] DB ì—°ê²° ì‹¤íŒ¨ â†’ 200 + ë¹ˆ ë°°ì—´ (404 ê¸ˆì§€)

### 3. í†µí•© í…ŒìŠ¤íŠ¸
- [ ] í”„ë¡ íŠ¸ì—”ë“œ â†’ ê²Œì´íŠ¸ì›¨ì´ â†’ auth_service ê²½ë¡œ ì •ìƒ ë™ì‘
- [ ] êµ­ê°€ ê²€ìƒ‰ ëª¨ë‹¬ì—ì„œ ê²€ìƒ‰ ê²°ê³¼ ì •ìƒ í‘œì‹œ
- [ ] korean_name ê°’ì´ ì˜¬ë°”ë¥´ê²Œ ì „ë‹¬ë˜ê³  í‘œì‹œë¨

## ğŸ“Š ê¸°ëŒ€ ê²°ê³¼

### ì„±ê³µ ê¸°ì¤€
1. âœ… GET /api/sitemapê°€ 200 OKë¡œ ì‘ë‹µ
2. âœ… êµ­ê°€ ê²€ìƒ‰ ëª¨ë‹¬ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™
3. âœ… korean_name ê¸°ì¤€ ê²€ìƒ‰ ê²°ê³¼ ì •í™•íˆ í‘œì‹œ
4. âœ… ê¸°ì¡´ /health ë“± ì—”ë“œí¬ì¸íŠ¸ ì˜í–¥ ì—†ìŒ

### ì„±ëŠ¥ ì§€í‘œ
- ì‘ë‹µ ì‹œê°„: < 500ms (ë¡œì»¬), < 2s (í”„ë¡œë•ì…˜)
- ê²€ìƒ‰ ì •í™•ë„: korean_name ë¶€ë¶„ ì¼ì¹˜ 100%
- ì—ëŸ¬ìœ¨: < 1%

## ğŸš¨ íšŒê·€ ìœ„í—˜ë„ ë° ëŒ€ì‘

### ìœ„í—˜ë„: ë‚®ìŒ (LOW)
- **ì´ìœ **: ìƒˆë¡œìš´ ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ë¡œ ê¸°ì¡´ ê¸°ëŠ¥ì— ì˜í–¥ ì—†ìŒ
- **ëŒ€ì‘**: ê¸°ì¡´ /health, /auth/* ì—”ë“œí¬ì¸íŠ¸ ì •ìƒ ë™ì‘ í™•ì¸

### ëª¨ë‹ˆí„°ë§ í¬ì¸íŠ¸
1. `/api/sitemap` ì‘ë‹µ ì‹œê°„ ë° ì„±ê³µë¥ 
2. êµ­ê°€ ê²€ìƒ‰ ëª¨ë‹¬ ì‚¬ìš© í†µê³„
3. ê²Œì´íŠ¸ì›¨ì´ ë¡œê·¸ì—ì„œ í”„ë¡ì‹œ ì„±ê³µë¥ 

## ğŸ“ ì¶”ê°€ ê°œì„ ì‚¬í•­

### 1. ê²€ìƒ‰ ì„±ëŠ¥ ìµœì í™”
- [ ] korean_name ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ ì¶”ê°€ í™•ì¸
- [ ] ê²€ìƒ‰ ê²°ê³¼ ìºì‹± êµ¬í˜„
- [ ] ë””ë°”ìš´ì‹± ì ìš© (í”„ë¡ íŠ¸ì—”ë“œ)

### 2. ëª¨ë‹ˆí„°ë§ ê°•í™”
- [ ] Prometheus ë©”íŠ¸ë¦­ ì¶”ê°€
- [ ] ê²€ìƒ‰ ì¿¼ë¦¬ ë¡œê¹…
- [ ] ì„±ëŠ¥ ëŒ€ì‹œë³´ë“œ êµ¬ì¶•

### 3. ì‚¬ìš©ì ê²½í—˜ ê°œì„ 
- [ ] ê²€ìƒ‰ ê²°ê³¼ í•˜ì´ë¼ì´íŒ…
- [ ] ìë™ì™„ì„± ê¸°ëŠ¥
- [ ] ê²€ìƒ‰ íˆìŠ¤í† ë¦¬ ì €ì¥

## ğŸ¯ ê²°ë¡ 

GET /api/sitemap 404 ë¬¸ì œëŠ” **ë¼ìš°í„° ë¯¸ë“±ë¡**ì´ ì£¼ìš” ì›ì¸ì´ì—ˆìœ¼ë©°, 
ìƒˆë¡œìš´ sitemap ë¼ìš°í„°ë¥¼ ìƒì„±í•˜ê³  ë“±ë¡í•¨ìœ¼ë¡œì¨ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.

**í•µì‹¬ í•´ê²° í¬ì¸íŠ¸**:
1. korean_name ê¸°ì¤€ ê²€ìƒ‰ì„ ìœ„í•œ ì „ìš© ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
2. í‘œì¤€í™”ëœ ì‘ë‹µ ìŠ¤í‚¤ë§ˆ ì ìš©
3. ê²Œì´íŠ¸ì›¨ì´ë¥¼ í†µí•œ ì˜¬ë°”ë¥¸ ë¼ìš°íŒ… ì„¤ì •
4. í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œ ê°„ ë°ì´í„° í˜•ì‹ ì¼ì¹˜

ì´ì œ êµ­ê°€ ê²€ìƒ‰ ëª¨ë‹¬ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ë©°, korean_name ê°’ì„ ì˜¬ë°”ë¥´ê²Œ ê²€ìƒ‰í•˜ê³  í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
